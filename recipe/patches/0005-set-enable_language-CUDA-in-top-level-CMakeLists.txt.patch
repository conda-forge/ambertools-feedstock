From 823ccb0fe08447379f01d9252040db730640f2ca Mon Sep 17 00:00:00 2001
From: "H. Vetinari" <h.vetinari@gmx.com>
Date: Fri, 30 Aug 2024 09:22:17 +1100
Subject: [PATCH 5/5] set `enable_language(CUDA)` in top-level CMakeLists.txt

see https://gitlab.kitware.com/cmake/cmake/-/issues/26246
---
 AmberTools/src/cpptraj/CMakeLists.txt | 1 +
 AmberTools/src/quick/CMakeLists.txt   | 4 ++++
 CMakeLists.txt                        | 1 +
 3 files changed, 6 insertions(+)

diff --git a/AmberTools/src/cpptraj/CMakeLists.txt b/AmberTools/src/cpptraj/CMakeLists.txt
index 25e66a6c..111a43c8 100644
--- a/AmberTools/src/cpptraj/CMakeLists.txt
+++ b/AmberTools/src/cpptraj/CMakeLists.txt
@@ -91,6 +91,7 @@ endif()
 
 # Ensure the flag for PIC is added for NVCC
 if (CUDA AND CUDA_FOUND)
+  enable_language(CUDA)
   if (SHARED)
     if(${COMPILER} STREQUAL GNU OR ${COMPILER} STREQUAL CLANG)
       set(CPPTRAJ_NVCC_PIC_FLAG "--compiler-options -fPIC")
diff --git a/AmberTools/src/quick/CMakeLists.txt b/AmberTools/src/quick/CMakeLists.txt
index 475f6d80..c7955555 100644
--- a/AmberTools/src/quick/CMakeLists.txt
+++ b/AmberTools/src/quick/CMakeLists.txt
@@ -240,6 +240,10 @@ endif()
 # --------------------------------------------------------------------
 include(QUICKCudaConfig)
 
+if (CUDA)
+    enable_language(CUDA)
+endif()
+
 #--------------------------------------------------------------	
 # Build code
 
diff --git a/CMakeLists.txt b/CMakeLists.txt
index dbe89192..3e084cbe 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -166,6 +166,7 @@ else() #include all configuration segments
 
 	# nccl is only used in pmemd.cuda
 	if(CUDA AND NOT AMBERTOOLS_ONLY)
+		enable_language(CUDA)
 		list(APPEND NEEDED_3RDPARTY_TOOLS nccl)
 	endif()
 
